#!/bin/sh
random=true
lock=true
wall=true
for var in "$@"
do
case $var in
    -l | --lock)
        wall=false
    ;;
    -w | --wall | --wallpaper)
        lock=false
    ;;
    -h | --help)
        echo "-w, --wall, --wallpaper   Set only wallpaper"
        echo "-l, --lock                Set only lockscreen wallpaper"
        echo "-n                        Choose specific wallpaper. Eg. 'wallpaper -n=4'"
        echo "-h, --help                Display this help message"
        echo "If no option is specified a random wallpaper will be set to both the wallpaper and the lockscreen wallpaper"
        exit
    ;;
    -n=*)
        num=$(echo $var | cut -d= -f2)
        re='^[0-9]+$'
        if [[ $num =~ $re ]];then
            n=$num
            random=false
        fi
    ;;
    *)
        echo "Erorr: Invalid option '$var'"
        echo "Try 'wallpaper -h' for more information"
        exit
    ;;
esac
done

if [ $lock == "false" ] && [ $wall == "false" ];then
    lock=true
    wall=true
fi

if [ $random == "true" ];then
    function random {
        n=$((1 + $RANDOM % 6))
        m=$(cat $HOME/.cache/random)
    }
    while [ $n = $m ]
    do
        random
    done
    echo $n > $HOME/.cache/random
fi

user=$(getent passwd | grep "$USER" | cut -d":" -f5 | cut -d"," -f1)
email=$(dconf read /org/bluesabre/mugshot/email | sed "s/'//g")
case $n in
    1)
        image="$HOME/dotfiles/wallpapers/Reddit/Nitesh Nagda/Fallen God.jpg"
        lock_image="$HOME/dotfiles/wallpapers/Lock/Fallen God.png"
        lock_image_email="$HOME/dotfiles/wallpapers/Lock/Email - Fallen God.png"
    ;;
    2)
        image="$HOME/dotfiles/wallpapers/Reddit/Quentin Mabille/Mummy.jpg"
        lock_image="$HOME/dotfiles/wallpapers/Lock/Mummy.png"
        lock_image_email="$HOME/dotfiles/wallpapers/Lock/Email - Mummy.png"
    ;;
    3)
        image="$HOME/dotfiles/wallpapers/Reddit/Tomislav Jagnjic/I don't wanna fight.jpg"
        lock_image="$HOME/dotfiles/wallpapers/Lock/I don't wanna fight.png"
        lock_image_email="$HOME/dotfiles/wallpapers/Lock/Email - I don't wanna fight.png"
    ;;
    4)
        image="$HOME/dotfiles/wallpapers/Reddit/Stefan Koidl/Dragon Bones.png"
        lock_image="$HOME/dotfiles/wallpapers/Lock/Dragon Bones.png"
        lock_image_email="$HOME/dotfiles/wallpapers/Lock/Email - Dragon Bones.png"
    ;;
    5)
        image="$HOME/dotfiles/wallpapers/Reddit/Jocelin Carme/Fallen Champion.jpg"
        lock_image="$HOME/dotfiles/wallpapers/Lock/Fallen Champion.png"
        lock_image_email="$HOME/dotfiles/wallpapers/Lock/Email - Fallen Champion.png"
    ;;
    6)
        image="$HOME/dotfiles/wallpapers/Reddit/Denis Loebner/Preserved in ice.jpg"
        lock_image="$HOME/dotfiles/wallpapers/Lock/Preserved in ice.png"
        lock_image_email="$HOME/dotfiles/wallpapers/Lock/Email - Preserved in ice.png"
    ;;
    *)
        echo "Error: Not valid index"
        exit
    ;;
esac

if [ $wall == "true" ];then
    feh "$image" --bg-fill
fi
if [ $lock == "true" ];then
   if [ -z $email ];then
       cp "$lock_image" $HOME/.cache/betterlockscreen/current/lock_resize.png
   else
       cp "$lock_image_email" $HOME/.cache/betterlockscreen/current/lock_resize.png
   fi
fi
